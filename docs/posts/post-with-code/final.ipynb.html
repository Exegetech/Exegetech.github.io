<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.3.433">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Vertikal Willis - Table Of Contents</title>    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>
    <style>
      .quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }
      .quarto-embed-header h6 {
        font-size: 1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 300;
      }
      .quarto-embed-header a.quarto-download-embed {
        font-size: 0.7em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }
    </style>
    
<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
     <script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>  
        <link rel="stylesheet" href="../../styles.css">
      </head>
  <body class="nav-fixed quarto-notebook fullcontent">
    <div class="quarto-embed-header">
      <h6><i class="bi bi-journal-code"></i> final.ipynb</h6>
      <a href="../../posts/post-with-code/final.ipynb" class="btn btn-primary quarto-download-embed" download="final.ipynb">Download Notebook</a>
    </div>
     <div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Vertikal Willis</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Table Of Contents</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content">      
   <blockquote class="blockquote">
<p>• Introduction.<br> • Data Introduction.<br> • Data Preparation (Import libraries, data cleaning &amp; data wrangling).<br> • Exploratory data analysis.<br> • Feature selection.<br> • Modelling.<br></p>
</blockquote>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<hr>
<blockquote class="blockquote">
<p>This project is a final project made as one of the requirements to pass dibimbing data science bootcamp. The dataset I used is telco customer churn, a dataset that is popular and commonly used for practice. I chose this dataset because it has a lot of columns and it seems to represent a ‘real-life’ dataset in a real telco company. The problem faced by the company is customer churn. When customer churn, the company suffered a loss. The solution is giving prospect and promos to potential churned customer, but this action also cost the company some money, so it is important to accurately target the churned customer. Based on this problem, I set 2 main goals: <br> 1.Look for useful informations, insights and pattern as many as possible by asking question &amp; doing exploratory data analysis.<br> 2.Create a ML model that served the best fit to company goal’s which is reducing losses.<br></p>
</blockquote>
</section>
<section id="data-introduction" class="level1 page-columns page-full">
<h1>Data Introduction</h1>
<hr>
<blockquote class="blockquote">
<p>This dataset contain informations about customers that churn and not churned in a telco company. Below is the column informations:<br> 1.customerID = customer unique ID.<br> 2.gender = customer gender (M/F).<br> 3.SeniorCitizen = old / young customer.<br> 4.Partner = either a customer has partners or not.<br> 5.Dependents = either a customer has dependents or not.<br> 6.tenure = how long the customer subscribed (in month).<br> 7.MultipleLines = either a customer using multiple lines or not (phone lines).<br> 8.InternetService = either a customer using InternetService lines or not.<br> 9.OnlineSecurity = either a customer has OnlineSecurity or not.<br> 10.OnlineBackup = either a customer has OnlineBackup or not.<br> 11.DeviceProtection = either a customer has DeviceProtection or not.<br> 12.TechSupport = either a customer has TechSupport or not.<br> 13.StreamingTV = either a customer has StreamingTV or not.<br> 14.StreamingMovies = either a customer has StreamingMovie or not.<br> 15.Contract = types of contract.<br> 16.PaperlessBilling = either a customer has PaperlessBilling or not.<br> 17.PaymentMethod = types of the payment method.<br> 18.MonthlyCharges = how much charges per month.<br> 19.TotalCharges = total charges of all time.<br> 20.Churn = either a customer churn or not.<br> 21.Hobby = customer hobby.<br><br> Dataset assumption : This telco company has been around for 7 years.</p>
</blockquote>
<section id="data-preparation-import-libraries-data-cleaning-data-wrangling" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="data-preparation-import-libraries-data-cleaning-data-wrangling">Data Preparation (Import libraries, data cleaning &amp; data wrangling)</h2>
<hr>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [1]:</pre></div><div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stat</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> gaussian_kde</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [2]:</pre></div><div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>github <span class="op">=</span> <span class="st">'https://raw.githubusercontent.com/vertikalwil/Data-Analyst/main/telco.csv'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [3]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359104,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="2366b164-8324-46c7-b7df-c285928418ef" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'github'</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Hobby</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7590-VHVEG</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>135</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>29.85</td>
<td>29.85</td>
<td>No</td>
<td>Swimming</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5575-GNVDE</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>34</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>One year</td>
<td>No</td>
<td>Mailed check</td>
<td>56.95</td>
<td>1889.5</td>
<td>No</td>
<td>Running</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>3668-QPYBK</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>140</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Mailed check</td>
<td>53.85</td>
<td>7560</td>
<td>Yes</td>
<td>Hiking</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7795-CFOCW</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>136</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>One year</td>
<td>No</td>
<td>Bank transfer (automatic)</td>
<td>42.45</td>
<td>1840.75</td>
<td>No</td>
<td>Swimming</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9237-HQITU</td>
<td>Female</td>
<td>0</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>70.70</td>
<td>151.65</td>
<td>Yes</td>
<td>Running</td>
</tr>
</tbody>
</table>

<p>5 rows × 22 columns</p>
</div>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [4]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:23,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3767453b-34e8-4162-c1ae-4b31e4af10ad" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(df.info()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7043 entries, 0 to 7042
Data columns (total 22 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   customerID        7043 non-null   object 
 1   gender            7043 non-null   object 
 2   SeniorCitizen     7043 non-null   int64  
 3   Partner           7043 non-null   object 
 4   Dependents        7043 non-null   object 
 5   tenure            7043 non-null   int64  
 6   PhoneService      7043 non-null   object 
 7   MultipleLines     7043 non-null   object 
 8   InternetService   7043 non-null   object 
 9   OnlineSecurity    7043 non-null   object 
 10  OnlineBackup      7043 non-null   object 
 11  DeviceProtection  6627 non-null   object 
 12  TechSupport       7043 non-null   object 
 13  StreamingTV       7043 non-null   object 
 14  StreamingMovies   7043 non-null   object 
 15  Contract          6798 non-null   object 
 16  PaperlessBilling  7043 non-null   object 
 17  PaymentMethod     7043 non-null   object 
 18  MonthlyCharges    7043 non-null   float64
 19  TotalCharges      4859 non-null   object 
 20  Churn             7043 non-null   object 
 21  Hobby             4201 non-null   object 
dtypes: float64(1), int64(2), object(19)
memory usage: 1.2+ MB
&lt;class 'NoneType'&gt;</code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [5]:</pre></div><div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>missingkolom <span class="op">=</span> [<span class="st">'DeviceProtection'</span>,<span class="st">'Contract'</span>,<span class="st">'TotalCharges'</span>,<span class="st">'Hobby'</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> missingkolom:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Missing value of column </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> (%) : </span><span class="sc">{</span><span class="bu">round</span>(df[x].isna().<span class="bu">sum</span>()<span class="op">/</span><span class="bu">len</span>(df) <span class="op">*</span> <span class="dv">100</span>,<span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value of column DeviceProtection (%) : 5.91
Missing value of column Contract (%) : 3.48
Missing value of column TotalCharges (%) : 31.01
Missing value of column Hobby (%) : 40.35</code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [6]:</pre></div><div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#impute missing values with univariate imputation by value proportion</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'DeviceProtection'</span>] <span class="op">=</span> df[<span class="st">'DeviceProtection'</span>].fillna(pd.Series(np.random.choice([<span class="st">'No'</span>,<span class="st">'Yes'</span>,<span class="st">'No internet service'</span>], p <span class="op">=</span> <span class="bu">list</span>(df[<span class="st">'DeviceProtection'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)), size<span class="op">=</span><span class="bu">len</span>(df))))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Contract'</span>] <span class="op">=</span> df[<span class="st">'Contract'</span>].fillna(pd.Series(np.random.choice([<span class="st">'Month-to-month'</span>,<span class="st">'Two year'</span>,<span class="st">'One year'</span>], p <span class="op">=</span> <span class="bu">list</span>(df[<span class="st">'Contract'</span>].value_counts(normalize<span class="op">=</span><span class="va">True</span>)), size<span class="op">=</span><span class="bu">len</span>(df))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Alasan melakukan imputation:<br> 1.Missing value sedikit.<br> 2.Kolom tidak memiliki relasi atau hubungan dikolom apapun sehingga multivariate imputasi tidak dimungkinkan.<br> 3.Menggunakan proporsi nilai lebih tepat dari pada sekedar menggunakan nilai ‘mode’.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [7]:</pre></div><div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'Hobby'</span>],inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Alasan melakukan delete kolom:<br> 1.Missing value terlalu banyak.<br> 2.Secara konteks, kolom tersebut tidak terlalu berguna dalam memberikan informasi.<br> 3.Tidak memiliki justifikasi yang kuat (tidak bisa diimpute secara multivariate).<br></p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [8]:</pre></div><div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalCharges'</span>] <span class="op">=</span> df[<span class="st">'TotalCharges'</span>].fillna(df[<span class="st">'tenure'</span>] <span class="op">*</span> df[<span class="st">'MonthlyCharges'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Alasan melakukan imputation:<br> 1.Walaupun missing value banyak namun imputasi tetap bisa dilakukan karena memiliki justifikasi yang kuat yaitu.<br> 2.Kolom TotalCharges nilainya kurang lebih merupakan dari nilai tenure * MonthlyCharges.<br> 3.Menggunakan proporsi nilai lebih tepat dari pada sekedar menggunakan nilai ‘mode’.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [9]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8424ee92-08be-47c3-b65c-50731eb84dc7" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#there's a space in the total charges column.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> df.TotalCharges:</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">float</span>(x)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f'Unable to convert to float with this value : </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  
Unable to convert to float with this value :  </code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [10]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:18,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359105,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="cf0d5a83-8763-4971-8f97-54265ea580b8" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df[df.TotalCharges <span class="op">==</span> <span class="st">' '</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">customerID</th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">488</td>
<td>4472-LVYGI</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>52.55</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">753</td>
<td>3115-CZMZD</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.25</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">936</td>
<td>5709-LVOEQ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>80.85</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1082</td>
<td>4367-NUYAO</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>Yes</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.75</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1334</td>
<td>1768-ZAIFU</td>
<td>Female</td>
<td>1</td>
<td>No</td>
<td>No</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>25.20</td>
<td></td>
<td>Yes</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1340</td>
<td>1371-DWPAZ</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>56.05</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3331</td>
<td>7644-OMVMY</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>19.85</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3826</td>
<td>3213-VVOLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>25.35</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4380</td>
<td>2520-SGTTA</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>20.00</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5218</td>
<td>2923-ARZLG</td>
<td>Male</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No internet service</td>
<td>...</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>No internet service</td>
<td>One year</td>
<td>Yes</td>
<td>Mailed check</td>
<td>19.70</td>
<td></td>
<td>No</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6670</td>
<td>4075-WKNIU</td>
<td>Female</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>Two year</td>
<td>No</td>
<td>Mailed check</td>
<td>73.35</td>
<td></td>
<td>No</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6754</td>
<td>2775-SEFEE</td>
<td>Male</td>
<td>0</td>
<td>No</td>
<td>Yes</td>
<td>0</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>61.90</td>
<td></td>
<td>No</td>
</tr>
</tbody>
</table>

<p>12 rows × 21 columns</p>
</div>
</div>
</div></div>
<blockquote class="blockquote">
<p>Berdasarkan data diatas, ketika TotalChargesnya kosong maka nilai tenure-nya juga 0. Ini menandakan bahwa rows tersebut merupakan customer yang baru bergabung (belum ada charges). Jumlahnya hanya 12 baris, let’s drop it.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [11]:</pre></div><div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop(df.index[df.TotalCharges <span class="op">==</span> <span class="st">' '</span>]).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [12]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:18,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359106,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="b764d9bd-c07a-4372-a29d-ea323b83ef1e" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check for duplicate data, if True then there's no duplicate.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>df.customerID.nunique() <span class="op">==</span> <span class="bu">len</span>(df) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>True</code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [13]:</pre></div><div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#feature engineering</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Services'</span>] <span class="op">=</span> df[[<span class="st">'PhoneService'</span>,<span class="st">'InternetService'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Both'</span> <span class="cf">if</span> <span class="bu">list</span>(x).count(<span class="st">'No'</span>) <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'Internet Only'</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'No'</span> <span class="cf">else</span> <span class="st">'Phone Only'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalBenefits'</span>] <span class="op">=</span> df[[<span class="st">'OnlineSecurity'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>), axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Penjelasan fitur baru: <br> 1.Services = services/produk yang digunakan yaitu ‘Phone Only’, ‘Internet Only’ atau ‘Both.<br> 2.TotalBenefits = jumlah benefit yang digunakan oleh customer. Benefit yang dimaksud adalah ’OnlineSecurity’, ‘DeviceProtection’, ‘OnlineBackup’, ‘TechSupport’, ‘StreamingTV’, ‘StreamingMovies’.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [14]:</pre></div><div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'SeniorCitizen'</span>] <span class="op">=</span> df.SeniorCitizen.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'Yes'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'No'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Saya mengubah nilai SeniorCitizen dari numerik menjadi string agar lebih aesthethic saat melakukan EDA nantinya.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [15]:</pre></div><div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#drop useless column</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'customerID'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [16]:</pre></div><div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.tenure <span class="op">=</span> df.tenure.astype(<span class="st">'int64'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df.MonthlyCharges <span class="op">=</span> df.MonthlyCharges.astype(<span class="st">'float64'</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df.TotalCharges <span class="op">=</span> df.TotalCharges.astype(<span class="st">'float64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [17]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:17,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359107,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="c0a04595-aaed-436d-afa3-b1191cb3cde3" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 7031 entries, 0 to 7030
Data columns (total 22 columns):
 #   Column            Non-Null Count  Dtype  
---  ------            --------------  -----  
 0   gender            7031 non-null   object 
 1   SeniorCitizen     7031 non-null   object 
 2   Partner           7031 non-null   object 
 3   Dependents        7031 non-null   object 
 4   tenure            7031 non-null   int64  
 5   PhoneService      7031 non-null   object 
 6   MultipleLines     7031 non-null   object 
 7   InternetService   7031 non-null   object 
 8   OnlineSecurity    7031 non-null   object 
 9   OnlineBackup      7031 non-null   object 
 10  DeviceProtection  7031 non-null   object 
 11  TechSupport       7031 non-null   object 
 12  StreamingTV       7031 non-null   object 
 13  StreamingMovies   7031 non-null   object 
 14  Contract          7031 non-null   object 
 15  PaperlessBilling  7031 non-null   object 
 16  PaymentMethod     7031 non-null   object 
 17  MonthlyCharges    7031 non-null   float64
 18  TotalCharges      7031 non-null   float64
 19  Churn             7031 non-null   object 
 20  Services          7031 non-null   object 
 21  TotalBenefits     7031 non-null   int64  
dtypes: float64(2), int64(2), object(18)
memory usage: 1.2+ MB</code></pre>
</div>
</div></div>
<blockquote class="blockquote">
<p>Columns non-null entry sudah sesuai data entry, yang artinya tidak ada missing value. Data type juga sudah sesuai.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [18]:</pre></div><div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalChargesDiff'</span>] <span class="op">=</span> df[[<span class="st">'tenure'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalCharges'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">round</span>(<span class="bu">abs</span>(<span class="dv">1</span> <span class="op">-</span> (x[<span class="dv">0</span>] <span class="op">*</span> x[<span class="dv">1</span>] <span class="op">/</span> x[<span class="dv">2</span>])) <span class="op">*</span> <span class="dv">100</span>,<span class="dv">3</span>),axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [19]:</pre></div><div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'TotalChargesDiff'</span>].sort_values(ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>0       13400.000
5        1357.404
18        788.048
19        330.214
3         213.633
128        73.511
47         72.615
4631       64.286
5802       63.380
20         58.263
6247       57.534
80         57.330
299        55.285
121        51.534
4195       44.990
Name: TotalChargesDiff, dtype: float64</code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [20]:</pre></div><div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.TotalChargesDiff <span class="op">&lt;</span> <span class="dv">40</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'TotalChargesDiff'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Disini saya membuat 1 kolom yaitu dengan tujuan untuk membandingkan seberapa jauh nilai totalcharges yang asli dan totalcharges dari perkalian tenure dan monthlycharges. Untuk data yang berbeda terlalu jauh (diatas 40%) maka akan didrop.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [21]:</pre></div><div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> numericategoric(df):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    num <span class="op">=</span> <span class="bu">len</span>(df._get_numeric_data().columns)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    cat <span class="op">=</span> <span class="bu">len</span>(df.columns) <span class="op">-</span> num</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TotalNumericalData = "</span> <span class="op">+</span> <span class="bu">str</span>(num))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"TotalCategoricalData = "</span> <span class="op">+</span> <span class="bu">str</span>(cat))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Numerical = "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">list</span>(df._get_numeric_data().columns )))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Categorical = "</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">list</span>(df.drop(df._get_numeric_data().columns, axis<span class="op">=</span><span class="dv">1</span>).columns)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [22]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:15,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359107,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="6fd750ef-03a5-45c6-8b8f-b5be98c30aec" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>numericategoric(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TotalNumericalData = 4
TotalCategoricalData = 18
Numerical = ['tenure', 'MonthlyCharges', 'TotalCharges', 'TotalBenefits']
Categorical = ['gender', 'SeniorCitizen', 'Partner', 'Dependents', 'PhoneService', 'MultipleLines', 'InternetService', 'OnlineSecurity', 'OnlineBackup', 'DeviceProtection', 'TechSupport', 'StreamingTV', 'StreamingMovies', 'Contract', 'PaperlessBilling', 'PaymentMethod', 'Churn', 'Services']</code></pre>
</div>
</div></div>
<blockquote class="blockquote">
<p>Mayoritas kolom adalah categorical.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [23]:</pre></div><div class="cell" data-scrolled="true" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Membagi kolom2 numerikal dan categorical </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>dfnum <span class="op">=</span> df._get_numeric_data()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>dfcat <span class="op">=</span> df.drop(columns <span class="op">=</span> dfnum.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="exploratory-data-analysis." class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis.">Exploratory data analysis.</h2>
<hr>
<section id="descriptive-statistics" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive Statistics</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [24]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:13,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359107,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3189de7c-197e-4764-db1b-f9bfe6d65df0" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>dfnum.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">TotalBenefits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7012.000000</td>
<td>7012.000000</td>
<td>7012.000000</td>
<td>7012.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>32.506560</td>
<td>64.732760</td>
<td>2286.410207</td>
<td>2.042926</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>24.564234</td>
<td>30.109753</td>
<td>2265.759401</td>
<td>1.835251</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>12.000000</td>
<td>13.500000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>9.000000</td>
<td>35.450000</td>
<td>402.437500</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>29.000000</td>
<td>70.300000</td>
<td>1397.250000</td>
<td>2.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>56.000000</td>
<td>89.850000</td>
<td>3784.125000</td>
<td>3.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>140.000000</td>
<td>118.750000</td>
<td>8684.800000</td>
<td>6.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div></div>
<blockquote class="blockquote">
<p>1.Semua kolom sepertinya sudah cukup simetris (nilai medan dan median mendekati) kecuali untuk kolom TotalCharges (positive skew).<br> 2.Perhitungan kolom TotalCharges adalah kurang lebih tenure * MonthlyCharges.<br> 3.Nilai min max setiap kolom juga wajar, tidak ada nilai negatif. Untuk TotalBenefits wajar ada nilai 0 karena ada customers yang tidak mengambil benefits sama sekali.<br></p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [25]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:14,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359108,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a0cb4619-90ed-4ff8-9888-2a3dd67a0abe" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dfcat.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">DeviceProtection</th>
<th data-quarto-table-cell-role="th">TechSupport</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Services</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
<td>7012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>3</td>
<td>2</td>
<td>4</td>
<td>2</td>
<td>3</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>No</td>
<td>Both</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>3542</td>
<td>5874</td>
<td>3624</td>
<td>4920</td>
<td>6336</td>
<td>3372</td>
<td>3087</td>
<td>3486</td>
<td>3075</td>
<td>3074</td>
<td>3459</td>
<td>2798</td>
<td>2769</td>
<td>3854</td>
<td>4155</td>
<td>2354</td>
<td>5155</td>
<td>4821</td>
</tr>
</tbody>
</table>

</div>
</div>
</div></div>
<blockquote class="blockquote">
<p>1.Pada setiap kolom tidak ada nilai unique values yang terlalu banyak (paling banyak hanya 4 di PaymentMethod).<br> 2.Gender Male adalah yang paling banyak tetapi jumlahnya hanya sekitar 3500-an dari 7000 entries, yang artinya hanya beda tipis dengan gender Female.<br> 3.Mayoritas SeniorCitizen, Partner dan Dependents adalah No yang artinya kebanyakan orang muda yang single dan tak ada tanggungan.<br> 4.Mayoritas juga memakai PhoneService tetapi tanpa MultipleLines.<br> 5.InternetService terbanyak adalah Fiber optic.<br> 6.Untuk benefits (dari OnlineSecurity-StreamingMovies) mayoritas adalah No atau mayoritas tidak menggunakan benefits yang ada.<br> 7.Contract terbanyak adalah Month-to-month, mayoritas customer tidak siap berkomitment panjang menggunakan produk telco ini.<br> 8.PaperlessBilling kebanyakan Yes dan favorit paymentmethod adalah Electronic check.<br> 9.Mayoritas customer pada dataset ini adalah kebanyakan yang tidak churned.<br> 10.Untuk services terbanyak ada pada ‘Both’ sebanyak 4832, artinya mayoritas customers menggunakan internet service dan phone service sekaligus.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [26]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:13,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644359108,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="ebe3719d-ba4d-4bb5-a5b6-2c5bdb56e1fc" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> dfcat.columns:</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="ss">f"Value counts for column </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(df[col].value_counts())</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"---"</span><span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Value counts for column gender:
Male      3542
Female    3470
Name: gender, dtype: int64
------------------------------


Value counts for column SeniorCitizen:
No     5874
Yes    1138
Name: SeniorCitizen, dtype: int64
------------------------------


Value counts for column Partner:
No     3624
Yes    3388
Name: Partner, dtype: int64
------------------------------


Value counts for column Dependents:
No     4920
Yes    2092
Name: Dependents, dtype: int64
------------------------------


Value counts for column PhoneService:
Yes    6336
No      676
Name: PhoneService, dtype: int64
------------------------------


Value counts for column MultipleLines:
No                  3372
Yes                 2964
No phone service     676
Name: MultipleLines, dtype: int64
------------------------------


Value counts for column InternetService:
Fiber optic    3087
DSL            2410
No             1515
Name: InternetService, dtype: int64
------------------------------


Value counts for column OnlineSecurity:
No                     3486
Yes                    2011
No internet service    1515
Name: OnlineSecurity, dtype: int64
------------------------------


Value counts for column OnlineBackup:
No                     3075
Yes                    2422
No internet service    1515
Name: OnlineBackup, dtype: int64
------------------------------


Value counts for column DeviceProtection:
No                     3074
Yes                    2427
No internet service    1511
Name: DeviceProtection, dtype: int64
------------------------------


Value counts for column TechSupport:
No                     3459
Yes                    2038
No internet service    1515
Name: TechSupport, dtype: int64
------------------------------


Value counts for column StreamingTV:
No                     2798
Yes                    2699
No internet service    1515
Name: StreamingTV, dtype: int64
------------------------------


Value counts for column StreamingMovies:
No                     2769
Yes                    2728
No internet service    1515
Name: StreamingMovies, dtype: int64
------------------------------


Value counts for column Contract:
Month-to-month    3854
Two year          1689
One year          1469
Name: Contract, dtype: int64
------------------------------


Value counts for column PaperlessBilling:
Yes    4155
No     2857
Name: PaperlessBilling, dtype: int64
------------------------------


Value counts for column PaymentMethod:
Electronic check             2354
Mailed check                 1599
Bank transfer (automatic)    1539
Credit card (automatic)      1520
Name: PaymentMethod, dtype: int64
------------------------------


Value counts for column Churn:
No     5155
Yes    1857
Name: Churn, dtype: int64
------------------------------


Value counts for column Services:
Both             4821
Phone Only       1515
Internet Only     676
Name: Services, dtype: int64
------------------------------

</code></pre>
</div>
</div></div>
</section>
<section id="univariate-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="univariate-analysis">Univariate Analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [27]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:4816,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644363913,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="170c154e-b2f7-4f3c-8eaa-b7dba683bd5c" data-execution_count="27">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    axarr[dfnum.columns.get_loc(x)].boxplot(df[x],patch_artist<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    axarr[dfnum.columns.get_loc(x)].set_xlabel(x)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Outliers checking on numeric columns"</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Terdapat 1 outliers yang tidak wajar, row tersebut akan didrop.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [28]:</pre></div><div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df[df.tenure <span class="op">&gt;</span> <span class="dv">125</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">StreamingTV</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Services</th>
<th data-quarto-table-cell-role="th">TotalBenefits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>140</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>Yes</td>
<td>...</td>
<td>No</td>
<td>No</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Mailed check</td>
<td>53.85</td>
<td>7560.0</td>
<td>Yes</td>
<td>Both</td>
<td>2</td>
</tr>
</tbody>
</table>

<p>1 rows × 22 columns</p>
</div>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [29]:</pre></div><div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df.drop(index<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [30]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:13,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644363913,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a547964b-2068-41fa-beb9-f5d5f4cdd30a" data-execution_count="30">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    sns.histplot(dfnum[x],color<span class="op">=</span><span class="st">'skyblue'</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'none'</span>, ax<span class="op">=</span>axarr[dfnum.columns.get_loc(x)])</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Distribution plot"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>1.Distribusi kolom tenure berbentuk U-shaped, mayoritas customers adalah customer yang sangat baru atau customer yang sangat lama.<br> 2.Untuk MonthlyCharges, kebanyakan customers terdapat pada rentan &lt; 30 USD lalu frekuensinya drop pada range 30 - 40 USD dan naik kembali sampai tertinggi ada di sekitar 80 USD. Sepertinya produk dengan range harga 30 - 40 USD kurang diminati atau terkesan tanggung.<br> 3.Pada TotalCharges, semakin tinggi TotalCharges maka frekuensinya semakin sedikit (Positive Skew).<br> 4.Untuk TotalBenefits, Benefit 0 adalah yang tertinggi.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [31]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:2927,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644366827,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="d3c33666-387d-4a3b-b2ff-3996eb789f6d" data-execution_count="31">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> dfcat.columns</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(features)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">5</span>, <span class="bu">len</span>(features)<span class="op">//</span><span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, i)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    sns.countplot(x<span class="op">=</span>df[features[i<span class="op">-</span><span class="dv">1</span>]], color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(features[i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'CountPlot'</span>, size<span class="op">=</span><span class="dv">19</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>1.Untuk paymentmethod, terlihat electronic check adalah terfavorit namun untuk metode lain terlihat cukup equal satu sama lain.<br> 2.Untuk phone service, terlihat bahwa mayoritas adalah pengguna phone service. Jumlahnya sangat berbeda jauh dengan yang tidak (imbalanced) sedangkan untuk multiple line nya mayoritas memilih ‘No’.<br> 3.Untuk SeniorCitizen juga sama, perbandingan antara ‘No’ dan ‘Yes’ cukup jauh yaitu mayoritas ada pada ‘No’.<br> 4.Untuk services ‘Both’ juga mendominasi cukup jauh dari Internet Only dan Phone Only.<br> 5.Untuk contract, ‘Month-to-month’ contract yang paling mendominasi disusul oleh ‘Two year’ dan ‘One year’ tetapi gap antara ‘Two year’ dan ‘One year’ tidak berbeda begitu jauh.<br> 6.Mayoritas ternyata tidak memiliki partner, namun gap nya terlihat tipis antara ‘Yes’ dan ‘No’.<br> 7.Mayoritas tidak memiliki dependent.<br> 8.Untuk benefit (OnlineSecurity sampai StreamingMovies) terlihat bahwa mayoritas customer lebih memilih ‘No’.<br> 9.Lebih banyak customer memilih paperlessbilling dari yang tidak.<br> 10.Mayoritas customer pada dataset ini adalah yang tidak churn.</p>
</blockquote>
</section>
<section id="multivariate-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="multivariate-analysis">Multivariate Analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [32]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:2131,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644368955,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a3140ce1-14b9-452a-e701-b518d094bcf2" data-execution_count="32">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>,<span class="dv">12</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> dfcat.columns</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> np.arange(<span class="dv">1</span>, <span class="bu">len</span>(features)<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">5</span>, <span class="bu">len</span>(features)<span class="op">//</span><span class="dv">3</span> <span class="op">-</span> <span class="dv">2</span>, i)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    sns.countplot(data<span class="op">=</span>df, x<span class="op">=</span>df[features[i<span class="op">-</span><span class="dv">1</span>]], hue<span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    plt.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">8</span>})</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(features[i<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">'CountPlot vs Churned'</span>, size<span class="op">=</span><span class="dv">19</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<p>Dibawah saya jabarkan beberapa kolom yang menarik :<br> 1.Untuk SeniorCitizen yang ‘Yes’, terlihat churn probabilitynya lebih tinggi dari yang ‘No’.<br> 2.Untuk Partner dan Dependents, Churn probability lebih rendah jika nilainya ‘Yes’.<br> 3.Customer yang tidak menggunakan MultipleLines, churn probabilitynya lebih rendah dari yang menggunakan MultipleLines.<br> 4.Churn probability fiber optic jauh lebih tinggi dari DSL.<br> 5.Untuk kolom benefits (OnlineSecurity sampai StreamingMovies), churn probabilitynya lebih rendah jika nilainya ‘Yes’ dari pada yang ‘No’.<br> 6.Untuk Contract, walaupun jumlah Month-to-month contract merupakan yang tertinggi namun churn probabilitynya juga merupakan yang tertinggi.<br> 7.Untuk PaymentMethod kasusnya juga mirip dengan contract, walaupun Electronic check merupakan pilihan mayoritas namun churn probabilitnya juga yang tertinggi.<br> 8.Untuk services, ‘Both’ terlihat memiliki churn probability tertinggi dari yang lain.</p>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [33]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:4080,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644373032,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="4fb0d4d8-157a-41e3-814d-368da499e070" data-execution_count="33">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnum.columns:</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    sns.histplot(data<span class="op">=</span>df , x <span class="op">=</span> dfnum[x],color<span class="op">=</span><span class="st">'skyblue'</span>, kde<span class="op">=</span><span class="va">True</span>, edgecolor<span class="op">=</span><span class="st">'none'</span>, ax<span class="op">=</span>axarr[dfnum.columns.get_loc(x)], hue<span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Distribution plot"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<p>Terlihat pada kolom tenure, bahwa semakin tinggi tenure maka semakin tinggi churn probability. Untuk kolom MonthlyCharges dan TotalCharges sepertinya tidak ada banyak insights yang bisa kita dapat (tidak terdapat relationship yang jelas), Untuk kolom TotalBenefits dapat dilihat bahwa untuk distribusi not churn tertinggi ada pada 0 lalu drop dan naik kembali sampai tertinggi ada di angka 3 dan kemudian drop kembali sampai akhir sedangkan untuk yang churn semakin banyak benefits maka semakin rendah frekuensinya.</p>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [34]:</pre></div><div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#mengubah binary column menjadi numerik agar bisa diproses di correlation dan pairplot.</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>dfcorr <span class="op">=</span> df.copy()</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>binary <span class="op">=</span> [<span class="st">'gender'</span>,<span class="st">'SeniorCitizen'</span>,<span class="st">'Partner'</span>,<span class="st">'Dependents'</span>,<span class="st">'PhoneService'</span>,<span class="st">'PaperlessBilling'</span>,<span class="st">'Churn'</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>value_mapping <span class="op">=</span> {</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No'</span>: <span class="dv">0</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Yes'</span> : <span class="dv">1</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span> : <span class="dv">1</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span> : <span class="dv">0</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> binary:</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>    dfcorr[col] <span class="op">=</span> dfcorr[col].<span class="bu">map</span>(value_mapping).astype(<span class="st">'int64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [35]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:7,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644373032,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="5a370df8-4d5b-432b-cc9c-ed8e651a803f" data-execution_count="35">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(dfcorr.corr(),annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\verti\AppData\Local\Temp\ipykernel_29428\779361340.py:2: FutureWarning: The default value of numeric_only in DataFrame.corr is deprecated. In a future version, it will default to False. Select only valid columns or specify the value of numeric_only to silence this warning.
  sns.heatmap(dfcorr.corr(),annot=True, fmt='.2f')</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-36-output-2.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>1.TotalBenefits dan TotalCharges memiliki korelasi yang cukup kuat di angka 0.75.<br> 2.MonthlyCharges memiliki korelasi yang cukup kuat dengan TotalBenefits dan TotalCharges.<br> 3.PaperlessBilling memiliki korelasi sedang dengan MonthlyCharges.<br> 4.PhoneService memiliki korelasi rendah dengan MonthlyCharges.<br> 5.tenure memiliki korelasi rendah terhadap MonthlyCharges, korelasi sedang terhadap Churn dan TotalBenefits dan korelasi tinggi terhadap TotalCharges.<br> 6.Partner memiliki korelasi sedang terhadap TotalCharges, tenure dan Dependents.<br> 7.Tenure dan churn memiliki korelasi negatif yang sedang, dimana semakin tinggi tenure maka semakin kecil kemungkinan customers untuk churn.<br> 8.Tenure dan totalbenefits memiliki korelasi sedang.<br> Perlu diingat bahwa korelasi tidak sama dengan kausasi (saling berpengaruh). Walaupun hubungan korelasi tinggi namun bukan berarti bahwa kedua hal tersebut saling berpengaruh. Contoh korelasi antara TotalCharges dan TotalBenefits cukup tinggi yaitu diangka 0.75. Namun sebenarnya TotalBenefits tidak secara langsung mempengaruhi TotalCharges, melainkan tenure &amp; MonthlyCharges lah yang mempengaruhi. Contoh kedua yaitu correlation antara PaperlessBilling dan Monthlycharges yaitu sebesar 0.35, padahal sebenarnya kedua hal ini sama sekali tidak berpengaruh, hanya saja customers yang mengambil produk MonthlyCharges yang tinggi lebih cenderung juga memilih PaperlessBilling. Tetapi bukan karena PaperlessBilling mempengaruhi MonthlyCharges(cmiiw).</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [36]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:86364,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644459390,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="b5567b64-6249-475e-ffb4-cfdb150e44ba" data-execution_count="36">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#sns.pairplot(dfcorr, hue='Churn')</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.show()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Ada beberapa hubungan kolom yang menarik yang akan saya bahas di deep dive EDA.</p>
</blockquote>
</section>
</section>
<section id="deep-dive-exploratory-data-analysis" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="deep-dive-exploratory-data-analysis">Deep-Dive Exploratory Data Analysis</h2>
<hr>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [37]:</pre></div><div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a function to plot probability.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> prob_plot(df,colom,x):</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    means <span class="op">=</span> df[colom].mean()</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    medians <span class="op">=</span> df[colom].median()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> df[df.Churn <span class="op">==</span> <span class="st">'Yes'</span>][colom].astype(<span class="st">'float64'</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    data1 <span class="op">=</span> df[df.Churn <span class="op">==</span> <span class="st">'No'</span>][colom].astype(<span class="st">'float64'</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    kde <span class="op">=</span> gaussian_kde(data)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    kde1 <span class="op">=</span> gaussian_kde(data1)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    dist_space <span class="op">=</span> np.linspace( <span class="bu">min</span>(data), <span class="bu">max</span>(data), <span class="dv">200</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    dist_space1 <span class="op">=</span> np.linspace( <span class="bu">min</span>(data1), <span class="bu">max</span>(data1), <span class="dv">200</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    axarr[x].plot( dist_space, kde(dist_space), label<span class="op">=</span><span class="st">'Churned'</span>, color<span class="op">=</span><span class="st">'orange'</span> )</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    axarr[x].plot( dist_space1, kde1(dist_space1), label<span class="op">=</span><span class="st">'Not churn'</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>    axarr[x].axvline(x <span class="op">=</span> means, linestyle <span class="op">=</span> <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'g'</span>, label<span class="op">=</span><span class="st">'Mean'</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>    axarr[x].axvline(x <span class="op">=</span> medians, linestyle <span class="op">=</span> <span class="st">'--'</span>, color<span class="op">=</span><span class="st">'r'</span>, label<span class="op">=</span><span class="st">'Median'</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    axarr[x].set_title(<span class="st">'Probability'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    axarr[x].<span class="bu">set</span>(ylabel <span class="op">=</span> <span class="st">'Probability'</span>, xlabel <span class="op">=</span> colom)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    axarr[x].legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<section id="services-internet-service-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="services-internet-service-analysis">Services &amp; Internet service analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [38]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:15,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644459390,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="3b5dfc76-98ae-43f3-e95c-024c8834ebb8" data-execution_count="38">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(df[df.Services <span class="op">==</span> <span class="st">'Both'</span>], x <span class="op">=</span> <span class="st">'InternetService'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>sns.countplot(df[df.Services <span class="op">==</span> <span class="st">'Internet Only'</span>], x <span class="op">=</span> <span class="st">'InternetService'</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">"Both phone service &amp; internet service"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">"Internet service only"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Comparison of internet services on product services"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q1. Internet service apa yang paling diminati oleh customer yang mengambil kedua paket phone + internet sekaligus dengan paket internet only?<br> Ans. Internet service yang paling diminati pada paket phone + internet adalah fiber optic sedangkan untuk internet only, internet service yang tersedia hanya DSL. Mungkin untuk menggunakan internet fiber optic juga diperlukan sambungan telepon sedangkan untuk DSL tidak harus.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [39]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:1333,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460709,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="c146769d-3b88-4454-bf06-7a0494efd1d7" data-execution_count="39">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>df.groupby(<span class="st">'Services'</span>)[<span class="st">'Churn'</span>].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(<span class="bu">list</span>(x))).plot(kind<span class="op">=</span><span class="st">'bar'</span>, width<span class="op">=</span><span class="fl">0.3</span>,rot<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>df[df.Services <span class="op">!=</span> <span class="st">'Phone Only'</span>].groupby([<span class="st">'InternetService'</span>])[<span class="st">'Churn'</span>].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x)).plot(kind<span class="op">=</span><span class="st">'bar'</span>, width<span class="op">=</span><span class="fl">0.3</span>,rot<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'Services churn probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Internet service churn probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'services.png'</span>,dpi<span class="op">=</span><span class="dv">600</span>, transparent<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q2. Bagaimana probabilitas churn antar services dan internet service?? jelaskan!<br> Ans. Untuk services, pengguna kedua internet + phone sekaligus adalah yang tertinggi yaitu lebih dari 30% sedangkan yang terendah adalah phone only dimana hanya sekitar 7% yang artinya produk phone dari perusahaan ini sudah sangat bagus. Untuk internet service, walaupun mayoritas memilih fiber optic namun probabilitas churnnya merupakan yang tertinggi yaitu sekitar 40% lebih, dimana DSL hanya 18%.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [40]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:29,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="bb7119df-12be-483f-de04-32199442ccde" data-execution_count="40">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df[df.Services <span class="op">!=</span> <span class="st">'Phone Only'</span>].groupby(<span class="st">'InternetService'</span>)[<span class="st">'TotalBenefits'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>InternetService
DSL            2.656704
Fiber optic    2.556527
Name: TotalBenefits, dtype: float64</code></pre>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q3. Apakah jenis internet service yang digunakan mempengaruhi jumlah benefits yang diambil?<br> Ans. Tidak, bisa dilihat bahwa rata-rata benefits antara customers fiber optic dan DSL cukup sama yaitu sekitar 2 - 3 benefits.</p>
</blockquote>
</section>
<section id="monthly-charges-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="monthly-charges-analysis">Monthly Charges Analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [41]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:26,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8117c6d1-344a-4989-ad74-87f75d24247d" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>dfpure <span class="op">=</span> df[(df.Services <span class="op">==</span> <span class="st">'Both'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">0</span>) <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>)].copy()</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>(dfpure.groupby(<span class="st">'InternetService'</span>)[<span class="st">'MonthlyCharges'</span>].mean() <span class="op">-</span> <span class="dv">20</span>).plot(kind<span class="op">=</span><span class="st">'bar'</span> ,rot <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"DSL &amp; Fiber optic price"</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">'services2.png'</span>,dpi<span class="op">=</span><span class="dv">600</span>, transparent<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-42-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q4. Berapa perbedaan MonthlyCharges antara DSL dan Fiber optic?<br> Ans. Setelah melakukan analisa dengan mengubah berbagai parameter, didapat bahwa Fiber optic lebih mahal sekitar 25 - 30 USD.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [42]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:25,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="80e9644f-1a90-4177-e68b-4374a785d47d" data-execution_count="42">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dfpure <span class="op">=</span> df[(df.Services <span class="op">==</span> <span class="st">'Phone Only'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">0</span>)].copy()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>dfpure.groupby(<span class="st">'MultipleLines'</span>)[<span class="st">'MonthlyCharges'</span>].mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>MultipleLines
No     19.957316
Yes    24.977812
Name: MonthlyCharges, dtype: float64</code></pre>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [43]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460710,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="2499b9e2-4388-49bf-ee6c-af13edec5c38" data-execution_count="43">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>sns.histplot(data<span class="op">=</span>dfpure, x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>,hue<span class="op">=</span><span class="st">'MultipleLines'</span>, multiple<span class="op">=</span><span class="st">'stack'</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Phone service distribution'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-44-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q5. Berapakah produk phone service dengan multipleline dan yang tidak?<br> Ans. Harga phone service tanpa multipleline adalah sekitar 20 USD dan sekitar 25 USD jika memakai multipleline.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [44]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:24,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460711,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="ce28b72e-2787-4f0e-925c-c76d3f9983d2" data-execution_count="44">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.histplot(data<span class="op">=</span>df, x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>,hue<span class="op">=</span><span class="st">'Churn'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>], multiple<span class="op">=</span><span class="st">'stack'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'Distribution'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].axvline(x = 30, linestyle = '--', color='black')</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].axvline(x = 69, linestyle = '--', color='black')</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].axvline(x = 19, linestyle = '--', color='black')</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].axvline(x = 119, linestyle = '--', color='black')</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].fill_between((30 , 69),1200, alpha=0.15, color='green')</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].fill_between((19 , 30),1200, alpha=0.15, color='magenta')</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a><span class="co">#axarr[0].fill_between((69 , 119),1200, alpha=0.15, color='orange')</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>prob_plot(df[df.MonthlyCharges <span class="op">&gt;=</span> <span class="dv">30</span>],<span class="st">'MonthlyCharges'</span>,<span class="dv">1</span>)</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q6. Buat segmentasi pemakaian produk terhadap MonthlyCharges dan buat plot probabilitas churnya!<br> Ans.<br> Penjelasan warna area:<br> 1.Untuk warna magenta : 92% pengguna phone only dan 8% pengguna internet only (DSL).<br> 2.Untuk warna hijau : 67% pengguna both internet &amp; phone service (91% DSL, 9% Fiber optic) dan 33% pengguna internet only (DSL).<br> 3.Untuk warna orange : 100% pengguna both internet &amp; phone service (83% pengguna fiber optic, 17% pengguna DSL).<br><br> Pada plot ini bisa dilihat bahwa MonthlyCharges ter-rendah merupakan produk phone service tanpa internet. Kedua, mayoritas pengguna DSL berada pada rentan 30 - 70 USD dan fiber optic diatas 70 USD. Ketiga, melihat probability plot yang dikanan bahwa kenaikan churned probability jauh lebih tinggi dari not churn pada monthly charges +-60 - 90 USD… ini artinya terdapat kenaikan volume dari customers pada range harga ini namun kenaikan customers yang churned jauh lebih banyak secara rasio dari pada yang not churn.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [45]:</pre></div><div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dfpure <span class="op">=</span> df[(df.InternetService <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (df.Services <span class="op">==</span> <span class="st">'Both'</span>) <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>)]</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>dfpureagg <span class="op">=</span> dfpure.groupby(<span class="st">'TotalBenefits'</span>)[<span class="st">'MonthlyCharges'</span>].agg(<span class="st">'mean'</span>).reset_index()</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>dfpureagg[<span class="st">'MonthlyCharges'</span>] <span class="op">=</span> dfpureagg.MonthlyCharges.<span class="bu">round</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [46]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:22,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460711,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="e99960cb-8117-4037-e1fa-e548ef109dc3" data-execution_count="46">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>dfpure, x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>, y <span class="op">=</span> <span class="st">'TotalBenefits'</span>, s<span class="op">=</span><span class="dv">35</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(dfpureagg, x <span class="op">=</span> <span class="st">'TotalBenefits'</span>, y <span class="op">=</span> <span class="st">'MonthlyCharges'</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'MonthlyCharges vs Totalbenefits'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Average MonthlyCharges vs Totalbenefits'</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-47-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q7. Jelaskan hubungan antara TotalBenefits dengan MonthlyCharges! <br> Ans. Bisa dilihat dari kedua plots diatas bahwasannya semakin banyak benefits yang diambil maka semakin mahal juga MonthlyChargesnya. Kenaikan setiap MonthlyCharges per benefit juga terlihat cukup equal yaitu sekitar 7 dollar setiap penambahan 1 benefits. FYI, jika kita memperhatikan pada plot sebelah kiri, terlihat bahwa ‘spread’ atau penyebaran nilai dari MonthlyCharges disetiap benefit cukup beragam, padahal kolom-kolom yang mempengaruhi nilai MonthlyCharges sudah difilter. Ini berarti masih ada variabel lain yang mempengaruhi nilai MonthlyCharges.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [47]:</pre></div><div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dfpure <span class="op">=</span> df[(df.InternetService <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (df.Services <span class="op">==</span> <span class="st">'Both'</span>) <span class="op">&amp;</span> (df.MultipleLines <span class="op">==</span> <span class="st">'No'</span>) <span class="op">&amp;</span> (df.TotalBenefits <span class="op">==</span> <span class="dv">1</span>)]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>benefits <span class="op">=</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>dfnew <span class="op">=</span> pd.DataFrame()</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> benefits:</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> pd.DataFrame([x, dfpure[dfpure[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].<span class="bu">min</span>(), dfpure[dfpure[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].<span class="bu">max</span>(), dfpure[dfpure[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].mean(), dfpure[dfpure[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'MonthlyCharges'</span>].median()]).transpose()</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    dfnew <span class="op">=</span> pd.concat([dfnew, a])</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>dfnew.columns <span class="op">=</span> [<span class="st">'Benefit'</span>,<span class="st">'MinCharges'</span>,<span class="st">'MaxCharges'</span>,<span class="st">'MeanCharges'</span>,<span class="st">'MedianCharges'</span>]    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [48]:</pre></div><div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>dfnew</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Benefit</th>
<th data-quarto-table-cell-role="th">MinCharges</th>
<th data-quarto-table-cell-role="th">MaxCharges</th>
<th data-quarto-table-cell-role="th">MeanCharges</th>
<th data-quarto-table-cell-role="th">MedianCharges</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>OnlineSecurity</td>
<td>73.2</td>
<td>80.3</td>
<td>74.965278</td>
<td>75.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>OnlineBackup</td>
<td>72.75</td>
<td>76.65</td>
<td>74.675556</td>
<td>74.65</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>DeviceProtection</td>
<td>68.95</td>
<td>76.65</td>
<td>74.213333</td>
<td>74.8</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>TechSupport</td>
<td>73.85</td>
<td>76.55</td>
<td>75.045455</td>
<td>74.7</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>StreamingTV</td>
<td>77.65</td>
<td>81.9</td>
<td>79.728906</td>
<td>79.725</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>StreamingMovies</td>
<td>12.0</td>
<td>86.45</td>
<td>79.078226</td>
<td>80.075</td>
</tr>
</tbody>
</table>

</div>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q8. Bagaimana perbandingan harga antara benefit? benefit manakah yang paling mahal?<br> Ans. Bisa dilihat bahwa benefit dari OnlineSecurity sampai TechSupport harganya cukup sama sedangkan benefit StreamingTV dan StreamingMovies memiliki harga yang lebih tinggi dari yang lain yaitu sekitar 4 - 5 USD lebih tinggi. Data harga diatas termasuk harga fiber optic dan phone service tanpa multiplelines, jika ingin mengetahui harga per benefit maka tinggal dikurangi 70 USD saja.</p>
</blockquote>
</section>
<section id="anomaly-detection" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="anomaly-detection">Anomaly detection</h3>
<p>Dari analisa EDA diatas kita bisa melakukan pengecekan terhadap nilai MonthlyCharges, apakah terdapat nilai yang tidak sesuai?</p>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [49]:</pre></div><div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> monthlychargesdiff(x):</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    estimation <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'PhoneService'</span>] <span class="op">==</span> <span class="st">'Yes'</span>:</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">20</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'MultipleLines'</span>] <span class="op">==</span> <span class="st">'Yes'</span>:</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">5</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'DSL'</span>:</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">25</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'Fiber optic'</span>:</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">50</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[<span class="st">'StreamingTV'</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="st">'StreamingMovies'</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">20</span> <span class="op">+</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">-</span> <span class="dv">2</span>) <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="st">'StreamingTV'</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">|</span> (x[<span class="st">'StreamingMovies'</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> <span class="dv">10</span> <span class="op">+</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">-</span> <span class="dv">1</span>) <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>        estimation <span class="op">+=</span> x[<span class="st">'TotalBenefits'</span>] <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">abs</span>(<span class="dv">1</span> <span class="op">-</span> (estimation <span class="op">/</span> x[<span class="st">'MonthlyCharges'</span>])) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [50]:</pre></div><div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MonthlyChargesEstimationDifference'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(monthlychargesdiff, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [51]:</pre></div><div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df[df.MonthlyChargesEstimationDifference <span class="op">&gt;</span> <span class="dv">200</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">StreamingMovies</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Services</th>
<th data-quarto-table-cell-role="th">TotalBenefits</th>
<th data-quarto-table-cell-role="th">MonthlyChargesEstimationDifference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>Female</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>69</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>Yes</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Credit card (automatic)</td>
<td>29.00</td>
<td>2050.00</td>
<td>No</td>
<td>Both</td>
<td>6</td>
<td>296.551724</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">389</td>
<td>Male</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>69</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>12.00</td>
<td>880.00</td>
<td>Yes</td>
<td>Both</td>
<td>3</td>
<td>733.333333</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">666</td>
<td>Male</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>No</td>
<td>Electronic check</td>
<td>12.00</td>
<td>13.50</td>
<td>Yes</td>
<td>Both</td>
<td>1</td>
<td>566.666667</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">859</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>45</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Two year</td>
<td>No</td>
<td>Bank transfer (automatic)</td>
<td>26.41</td>
<td>1189.00</td>
<td>No</td>
<td>Both</td>
<td>3</td>
<td>278.644453</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1439</td>
<td>Female</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>60</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Two year</td>
<td>Yes</td>
<td>Electronic check</td>
<td>18.26</td>
<td>1095.60</td>
<td>No</td>
<td>Both</td>
<td>4</td>
<td>447.645126</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2185</td>
<td>Male</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>34</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>One year</td>
<td>Yes</td>
<td>Electronic check</td>
<td>21.63</td>
<td>735.42</td>
<td>No</td>
<td>Both</td>
<td>4</td>
<td>362.320851</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4090</td>
<td>Female</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>59</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>Yes</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>31.26</td>
<td>1846.55</td>
<td>No</td>
<td>Both</td>
<td>4</td>
<td>219.897633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5848</td>
<td>Female</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>Yes</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>15.00</td>
<td>15.56</td>
<td>Yes</td>
<td>Both</td>
<td>2</td>
<td>466.666667</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6718</td>
<td>Female</td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>1</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Yes</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>21.00</td>
<td>22.10</td>
<td>Yes</td>
<td>Both</td>
<td>2</td>
<td>304.761905</td>
</tr>
</tbody>
</table>

<p>9 rows × 23 columns</p>
</div>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [52]:</pre></div><div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[df.MonthlyChargesEstimationDifference <span class="op">&lt;</span> <span class="dv">200</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<p>Recap – What we know so far<br> 1.Hal yang mempengaruhi MonthlyCharges adalah services, internet service, multiplelines, totalbenefits dan jenis benefitnya.<br> 2.Phone service yang menggunakan multiple line lebih mahal dari yang tidak (lebih mahal +- 5 USD).<br> 3.Semua pengguna internet fiber optic pasti menggunakan phone service.<br> 4.Pengguna fiber optic lebih banyak dari DSL, namun churn probabilitynya juga jauh lebih tinggi fiber optic dari pada DSL.<br> 5.Fiber optic lebih mahal sekitar 25 - 30 USD dari DSL.<br> 6.Internet service tidak berpengaruh terhadap jumlah benefits yang diambil.<br> 7.Churn probability meningkat drastis saat MonthlyCharges mulai menyentuh 60 USD.<br> 8.Semua benefit memiliki harga yang serupa kecuali untuk StreamingTV dan StreamingMovies dimana kedua benefit ini lebih mahal sekitar 4 - 5 USD.</p>
</section>
<section id="customer-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="customer-analysis">Customer analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [53]:</pre></div><div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> statuss(x):</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">list</span>(x)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Both'</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'Yes'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'No'</span>):</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Partner Only'</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> (x[<span class="dv">0</span>] <span class="op">==</span> <span class="st">'No'</span>) <span class="op">&amp;</span> (x[<span class="dv">1</span>] <span class="op">==</span> <span class="st">'Yes'</span>):</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Dependent Only'</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'Single'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [54]:</pre></div><div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Status'</span>] <span class="op">=</span> df[[<span class="st">'Partner'</span>,<span class="st">'Dependents'</span>]].<span class="bu">apply</span>(statuss, axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<blockquote class="blockquote">
<p>Di atas saya membuat fitur baru bernama ‘Status’ dimana nilainya adalah:<br> 1.Jika tidak ada partner dan dependents maka nilainya ‘Single’.<br> 2.Jika hanya ada partner saja maka nilainya ‘Partner Only’.<br> 3.Jika hanya ada dependent saja maka nilainya ‘Dependent Only’.<br> 4.Jika terdapat partner dan dependent maka nilainya ‘Both’.<br></p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [55]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460712,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="92ac2c61-a43c-49e7-a10d-bf2619ae13d4" data-execution_count="55">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sns.countplot(df.sort_values(<span class="st">'Status'</span>, ascending<span class="op">=</span><span class="va">True</span>), x<span class="op">=</span><span class="st">'Status'</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Status Count'</span>, size<span class="op">=</span><span class="dv">16</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-56-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q9. Jelaskan segmentasi customer berdasarkan status partner dan dependent!<br> Ans. Jumlah terbanyak customer adalah yang single, disusul oleh Partner only dan both yang jumlahnya cukup berimbang dan yang terakhir dependent only.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [56]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460712,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="bb780263-68a3-4cf7-bb4c-7cb0caf75bfb" data-execution_count="56">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> [<span class="st">'tenure'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalBenefits'</span>]</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> k:</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    sns.barplot(df.groupby([<span class="st">'Status'</span>])[[x]].mean().reset_index(), x <span class="op">=</span><span class="st">'Status'</span>, y <span class="op">=</span>x, ax <span class="op">=</span>axarr[k.index(x)],palette<span class="op">=</span>[<span class="st">'grey'</span>, <span class="st">'g'</span>,<span class="st">'m'</span>,<span class="st">'b'</span>])</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    axarr[k.index(x)].set_title(<span class="ss">f'</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> average'</span>, weight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-57-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q10. Bagaimana behaviour status customer terhadap tenure, MonthlyCharges dan TotalBenefits?<br> Bisa dilihat plots diatas, bahwa customer dengan partner only adalah merupakan customer paling bagus. Mereka adalah customer ter-loyal, mereka mengambil produk dengan monthly charges tertinggi dan mereka merupakan pengguna benefits terbanyak. Customer yang memiliki kedua partner dan dependent juga cukup bagus namun tidak sebagus yang partner only. Untuk customer single, monthly charges yang dibayar cukup tinggi namun tenure nya tidak terlalu lama.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [57]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460713,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="e59c631a-c7db-401b-b61b-4cb64e9cae6d" data-execution_count="57">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sns.barplot(df.groupby(<span class="st">'Status'</span>)[[<span class="st">'Churn'</span>]].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">/</span> <span class="bu">len</span>(x)).reset_index(), x <span class="op">=</span> <span class="st">'Status'</span> , y <span class="op">=</span><span class="st">'Churn'</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Churn Probability'</span>, weight<span class="op">=</span><span class="st">'bold'</span>, size<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-58-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q11. Status customer manakah yang paling tinggi churn probabilitynya?<br> Ans. Customer Single adalah customer yang paling tinggi churn probabilitynya yang hampir mencapai 35%, disusul oleh partner only, dependent only dan both.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [58]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460713,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="88e0aacd-d3b0-4bf5-c098-6188aa3680c6" data-execution_count="58">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df.SeniorCitizen.value_counts().plot(kind<span class="op">=</span><span class="st">'pie'</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-59-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [59]:</pre></div><div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dfnew <span class="op">=</span> df.groupby(<span class="st">'SeniorCitizen'</span>)[[<span class="st">'Status'</span>]].agg(Single <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Single'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x)), PartnerOnly <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Partner Only'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)), Both <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Both'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)), DependentOnly <span class="op">=</span> (<span class="st">'Status'</span>, <span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Dependent Only'</span>) <span class="op">*</span> <span class="dv">100</span>  <span class="op">/</span> <span class="bu">len</span>(x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [60]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:21,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460714,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="a518d565-5aa8-44dc-bc45-539538aae93c" data-execution_count="60">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>dfnew.<span class="bu">round</span>().plot(kind<span class="op">=</span><span class="st">'bar'</span>,rot<span class="op">=</span><span class="dv">0</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Status comparison between senior citizen"</span>, size<span class="op">=</span><span class="dv">15</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-61-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q12. Bagaimana perbedaan status antara SeniorCitizen dan yang tidak?<br> Dari grafik diatas, bisa dilihat bahwa orang muda dan tua mayoritas adalah single. Untuk orang tua, jumlah partner yang dimiliki sangat tinggi namun jumlah dependentsnya sangat rendah sedangkan untuk yang lebih muda, jumlah partner dan dependent lebih seimbang.IMHO, menurut saya ini cukup logis karena memang kebanyakan orang tua yang sudah pensiun tidak memiliki tanggungan lagi, sedangkan untuk orang lebih muda dan masih bekerja, jumlah tanggungan mereka pasti akan lebih banyak.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [61]:</pre></div><div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dfnew <span class="op">=</span> df.groupby(<span class="st">'Status'</span>)[[<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>dfnew[<span class="st">'total'</span>] <span class="op">=</span> dfnew.<span class="bu">apply</span>(<span class="st">'sum'</span>,axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> dfnew.drop(columns<span class="op">=</span><span class="st">'total'</span>).columns:</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>    dfnew[x] <span class="op">=</span> (dfnew[x] <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> dfnew.total).<span class="bu">round</span>()</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>dfnew.drop(columns<span class="op">=</span><span class="st">'total'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [62]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:20,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644460715,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="0213aa2b-d477-4d53-9800-82148d57f615" data-execution_count="62">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dfnew.plot(kind<span class="op">=</span><span class="st">'bar'</span>, rot<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Benefit count comparison between status (%)'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-63-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q13. Analisa benefit yang diambil di setiap segmen customer!<br> Berdasarkan plot diatas, customer single dan partner only mayoritas memilih benefit hiburan yaitu streaming tv dan streaming movies disusul oleh online backup dan device protection tetapi untuk tech support dan online security terlihat tidak terlalu diminati. Untuk customer dependent, benefit yang terpenting adalah online security dan online backup sedangkan yang terendah adalah device protection. Untuk customer both terlihat bahwa semua nilai benefit tidak berbeda begitu jauh satu sama lain atau nilainya cukup equal. Kesimpulan : customer tanpa dependent terlihat lebih mementingkan benefit hiburan sedangkan yang memiliki dependent terlihat lebih mementingkan keamanan. Terakhir benefit online backup juga cukup penting disemua kalangan customer.</p>
</blockquote>
</section>
<section id="benefits-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="benefits-analysis">Benefits analysis</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [63]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:1450,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644462145,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="8c9a5f17-99b8-49f1-d489-a584a40403da" data-execution_count="63">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>sns.countplot(df[df.Services <span class="op">!=</span> <span class="st">'Phone Only'</span>], x <span class="op">=</span> <span class="st">'TotalBenefits'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(df[[<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>)).reset_index(), x <span class="op">=</span> <span class="st">'index'</span>, y <span class="op">=</span> <span class="dv">0</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'TotalBenefits Count'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Benefits Count'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-64-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q14. Berapa TotalBenefits terbanyak dan benefit apa saja yang paling banyak dipilih oleh customer?<br> Terlihat bahwa rata2 customer kebanyakan mengambil 3 benefits. Untuk benefit terfavorit ada pada sesi entertain yaitu StreamingTV dan StreamingMovies. FYI, untuk TotalBenefits saat kita melakukan standard EDA yang tertinggi adalah 0 benefits dikarenakan produk ‘Phone Only’ semuanya terhitung 0 benefits. Analisa Totalbenefits yang benar adalah kita mengexclude ‘Phone Only’ karena benefit hanya bisa diambil jika memiliki koneksi internet.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [64]:</pre></div><div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dfnew <span class="op">=</span> pd.DataFrame()</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]:</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> <span class="bu">list</span>(df[df[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'Churn'</span>]).count(<span class="st">'Yes'</span>) <span class="op">/</span> <span class="bu">len</span>(df[df[x] <span class="op">==</span> <span class="st">'Yes'</span>][<span class="st">'Churn'</span>])</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    dfnew <span class="op">=</span> pd.concat([dfnew, pd.DataFrame([x],[a])])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [65]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:5,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644462146,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="ca567756-56c7-422b-bc62-5957e94729b4" data-execution_count="65">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sns.barplot(df.groupby(<span class="st">'TotalBenefits'</span>)[[<span class="st">'Churn'</span>]].agg(<span class="kw">lambda</span> x: <span class="bu">list</span>(x).count(<span class="st">'Yes'</span>) <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> <span class="bu">len</span>(x)).<span class="bu">round</span>().reset_index(), x <span class="op">=</span> <span class="st">'TotalBenefits'</span>, y <span class="op">=</span> <span class="st">'Churn'</span>, ax<span class="op">=</span>axarr[<span class="dv">0</span>])</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>sns.barplot(dfnew.reset_index(), x <span class="op">=</span> <span class="dv">0</span>, y <span class="op">=</span> <span class="st">'index'</span>, ax<span class="op">=</span>axarr[<span class="dv">1</span>])</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].set_title(<span class="st">'TotalBenefits Churn probability'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">0</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].<span class="bu">set</span>(ylabel<span class="op">=</span><span class="va">None</span>, xlabel<span class="op">=</span><span class="st">'Benefits'</span>)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].set_title(<span class="st">'Benefits Churn probability'</span>, size<span class="op">=</span><span class="dv">12</span>, weight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>axarr[<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">25</span>)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>fig.tight_layout(pad<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-66-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Q15. Plot dan jelaskan churn probability untuk TotalBenefits dan benefits!<br> Totalbenefit dengan kemungkinan churn tertinggi ada pada 1 benefit. Walaupun benefit streamingTV dan streamingMovies merupakan benefit yang paling diminati namun secara rasio, kedua benefit ini malah yang memiliki kemungkinan churn tertinggi.</p>
</blockquote>
</section>
<section id="churn-analysis" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="churn-analysis">Churn analysis</h3>
<blockquote class="blockquote">
<p>Q16. Temukan dan jelaskan pattern perilaku customer yang churn dan tidak!</p>
</blockquote>
<blockquote class="blockquote">
<p>Pada tahap ini, saya akan menganalisa pattern behaviour customer yang churn dan tidak. Namun, saya perlu memplot 5 dimensi features dalam 1 scatter plot. Tentu hal ini akan sangat membingungkan dan saya akan membagi menjadi 2 scatter plot saja. First, saya akan membuat scatter plot tenure vs MonthlyCharges vs churn. Kedua, saya akan membuat scatter plot tenure vs MonthlyCharges vs TotalBenefits vs InternetService.</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [66]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:2475,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644464617,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="1c9642d7-a37f-4cfc-abc1-37fd31be306f" data-execution_count="66">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>fig, axarr <span class="op">=</span> plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df, x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>, y <span class="op">=</span> <span class="st">'tenure'</span>, hue <span class="op">=</span><span class="st">'Churn'</span>, s<span class="op">=</span><span class="dv">35</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="fl">52.5</span>, <span class="fl">72.5</span>, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MonthlyCharges vs tenure vs Churn'</span>, size <span class="op">=</span> <span class="dv">15</span>, weight <span class="op">=</span> <span class="st">'bold'</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-67-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Berdasarkan hasil analisa sebelumnya, didapat bahwa mayoritas customer ada pada range MonthlyCharges sekitar 60 dollar sampai dengan sekitar 100 dollar. Pada range harga ini saya menemukan sebuah pattern yang cukup jelas yaitu pada area hijau terlihat bahwa banyak customer churn berkumpul pada area ini, sedangkan pada range harga yang sama pada area biru terlihat bahwa justru customer tidak churn yang mendominasi. Pada area hijau nilai tenurenya cukup rendah yaitu hanya 0 - 20 bulan saja (new customers), sedangkan pada area biru nilai tenurenya sudah tinggi (loyal customers).</p>
</blockquote>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [67]:</pre></div><div class="cell" data-executioninfo="{&quot;elapsed&quot;:2365,&quot;status&quot;:&quot;ok&quot;,&quot;timestamp&quot;:1679644466969,&quot;user&quot;:{&quot;displayName&quot;:&quot;vertikal willis&quot;,&quot;userId&quot;:&quot;09422096490593763616&quot;},&quot;user_tz&quot;:-420}" data-outputid="041fbef0-cc28-482a-d89f-e464a718002c" data-execution_count="67">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>plt.subplots(<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(data<span class="op">=</span>df, x <span class="op">=</span> <span class="st">'MonthlyCharges'</span>, y <span class="op">=</span> <span class="st">'tenure'</span>, s<span class="op">=</span><span class="dv">35</span>, hue<span class="op">=</span><span class="st">'TotalBenefits'</span>, style<span class="op">=</span><span class="st">'InternetService'</span>, palette<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="dv">20</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>plt.fill_between((<span class="dv">68</span> , <span class="dv">97</span>),<span class="fl">52.5</span>, <span class="fl">72.5</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'MonthlyCharges vs tenure vs TotalBenefits vs InternetService'</span>, size <span class="op">=</span> <span class="dv">15</span>, weight <span class="op">=</span> <span class="st">'bold'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="final_files/figure-html/cell-68-output-1.png" class="img-fluid"></p>
</div>
</div></div>
<blockquote class="blockquote">
<p>Masih pada area chart yang sama, saya merombak sedikit features pada scatterplot ini. Saya mengganti feature Churn menjadi TotalBenefits dan InternetService. Bisa dilihat secara jelas bahwa pada area chart hijau, mayoritas internet service yang digunakan adalah fiber optic namun totalbenefits yang diambil sedikit sedangkan pada area chart biru mayoritas menggunakan internet service DSL namun totalbenefitsnya lebih banyak. Pada range harga ini, customers hanya dihadapkan oleh 2 pilihan yaitu menggunakan internet fiber optic yang lebih mahal dari DSL tetapi imbasnya totalbenefits yang bisa dipilih lebih sedikit atau menggunakan internet DSL yang murah namun totalbenefits yang diambil bisa lebih banyak. Dan ternyata customers lebih memilih internet service DSL yang lebih murah namun dengan totalbenefits yang lebih banyak. Kemungkinan hal ini bisa terjadi karena perbedaan harga antara fiber optic dan dsl tidak setara dengan perbedaan keuntungannya yang membuat fiber optic menjadi tidak worth it.</p>
</blockquote>
</section>
</section>
<section id="modelling" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="modelling">Modelling</h2>
<hr>
<section id="feature-selection-encoding" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="feature-selection-encoding">Feature selection &amp; encoding</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [68]:</pre></div><div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">gender</th>
<th data-quarto-table-cell-role="th">SeniorCitizen</th>
<th data-quarto-table-cell-role="th">Partner</th>
<th data-quarto-table-cell-role="th">Dependents</th>
<th data-quarto-table-cell-role="th">tenure</th>
<th data-quarto-table-cell-role="th">PhoneService</th>
<th data-quarto-table-cell-role="th">MultipleLines</th>
<th data-quarto-table-cell-role="th">InternetService</th>
<th data-quarto-table-cell-role="th">OnlineSecurity</th>
<th data-quarto-table-cell-role="th">OnlineBackup</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Contract</th>
<th data-quarto-table-cell-role="th">PaperlessBilling</th>
<th data-quarto-table-cell-role="th">PaymentMethod</th>
<th data-quarto-table-cell-role="th">MonthlyCharges</th>
<th data-quarto-table-cell-role="th">TotalCharges</th>
<th data-quarto-table-cell-role="th">Churn</th>
<th data-quarto-table-cell-role="th">Services</th>
<th data-quarto-table-cell-role="th">TotalBenefits</th>
<th data-quarto-table-cell-role="th">MonthlyChargesEstimationDifference</th>
<th data-quarto-table-cell-role="th">Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>34</td>
<td>Yes</td>
<td>No</td>
<td>DSL</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>One year</td>
<td>No</td>
<td>Mailed check</td>
<td>56.95</td>
<td>1889.50</td>
<td>No</td>
<td>Both</td>
<td>2</td>
<td>3.424056</td>
<td>Single</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Female</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>2</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>70.70</td>
<td>151.65</td>
<td>Yes</td>
<td>Both</td>
<td>0</td>
<td>0.990099</td>
<td>Single</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>22</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>Yes</td>
<td>...</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>89.10</td>
<td>1949.40</td>
<td>No</td>
<td>Both</td>
<td>2</td>
<td>1.010101</td>
<td>Dependent Only</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Female</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>10</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>Month-to-month</td>
<td>No</td>
<td>Mailed check</td>
<td>29.75</td>
<td>301.90</td>
<td>No</td>
<td>Internet Only</td>
<td>1</td>
<td>0.840336</td>
<td>Single</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Female</td>
<td>No</td>
<td>Yes</td>
<td>No</td>
<td>28</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>104.80</td>
<td>3046.05</td>
<td>Yes</td>
<td>Both</td>
<td>4</td>
<td>0.190840</td>
<td>Partner Only</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6997</td>
<td>Male</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>24</td>
<td>Yes</td>
<td>Yes</td>
<td>DSL</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>One year</td>
<td>Yes</td>
<td>Mailed check</td>
<td>84.80</td>
<td>1990.50</td>
<td>No</td>
<td>Both</td>
<td>5</td>
<td>0.235849</td>
<td>Both</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6998</td>
<td>Female</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>72</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>Yes</td>
<td>...</td>
<td>One year</td>
<td>Yes</td>
<td>Credit card (automatic)</td>
<td>103.20</td>
<td>7362.90</td>
<td>No</td>
<td>Both</td>
<td>4</td>
<td>1.744186</td>
<td>Both</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6999</td>
<td>Female</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
<td>11</td>
<td>No</td>
<td>No phone service</td>
<td>DSL</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Electronic check</td>
<td>29.60</td>
<td>346.45</td>
<td>No</td>
<td>Internet Only</td>
<td>1</td>
<td>1.351351</td>
<td>Both</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7000</td>
<td>Male</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>4</td>
<td>Yes</td>
<td>Yes</td>
<td>Fiber optic</td>
<td>No</td>
<td>No</td>
<td>...</td>
<td>Month-to-month</td>
<td>Yes</td>
<td>Mailed check</td>
<td>74.40</td>
<td>306.60</td>
<td>Yes</td>
<td>Both</td>
<td>0</td>
<td>0.806452</td>
<td>Partner Only</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7001</td>
<td>Male</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>66</td>
<td>Yes</td>
<td>No</td>
<td>Fiber optic</td>
<td>Yes</td>
<td>No</td>
<td>...</td>
<td>Two year</td>
<td>Yes</td>
<td>Bank transfer (automatic)</td>
<td>105.65</td>
<td>6844.50</td>
<td>No</td>
<td>Both</td>
<td>5</td>
<td>0.615239</td>
<td>Single</td>
</tr>
</tbody>
</table>

<p>7002 rows × 24 columns</p>
</div>
</div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [69]:</pre></div><div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df.drop(columns <span class="op">=</span> [<span class="st">'Services'</span>,<span class="st">'MonthlyChargesEstimationDifference'</span>,<span class="st">'Status'</span>,<span class="st">'PaperlessBilling'</span>,<span class="st">'PaymentMethod'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [70]:</pre></div><div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>KolomBenefit <span class="op">=</span> [<span class="st">'OnlineSecurity'</span>,<span class="st">'OnlineBackup'</span>,<span class="st">'DeviceProtection'</span>,<span class="st">'TechSupport'</span>,<span class="st">'StreamingTV'</span>,<span class="st">'StreamingMovies'</span>]</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> x <span class="kw">in</span> KolomBenefit:</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    df[x] <span class="op">=</span> df[x].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'No internet service'</span> <span class="cf">else</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [71]:</pre></div><div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'MultipleLines'</span>] <span class="op">=</span> df[x].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'No'</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'No phone service'</span> <span class="cf">else</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [72]:</pre></div><div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>value_mapping <span class="op">=</span> {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'No'</span>: <span class="dv">0</span>,</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Yes'</span> : <span class="dv">1</span>,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Male'</span> : <span class="dv">1</span>,</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Female'</span> : <span class="dv">0</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [73]:</pre></div><div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>binary <span class="op">=</span> <span class="bu">list</span>(df.drop(columns<span class="op">=</span>[<span class="st">'tenure'</span>,<span class="st">'InternetService'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'TotalCharges'</span>,<span class="st">'TotalBenefits'</span>,<span class="st">'Contract'</span>]).columns)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> binary:</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    df[col] <span class="op">=</span> df[col].<span class="bu">map</span>(value_mapping).astype(<span class="st">'int64'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [74]:</pre></div><div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Contract'</span>] <span class="op">=</span> df[<span class="st">'Contract'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'Month-to-month'</span> <span class="cf">else</span> <span class="dv">2</span> <span class="cf">if</span> x <span class="op">==</span> <span class="st">'One year'</span> <span class="cf">else</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [75]:</pre></div><div class="cell" data-scrolled="true" data-execution_count="75">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'is_cheap'</span>] <span class="op">=</span> df.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> (x[<span class="st">'InternetService'</span>] <span class="op">==</span> <span class="st">'Fiber optic'</span>) <span class="op">&amp;</span> (x[<span class="st">'TotalBenefits'</span>] <span class="op">&lt;</span> <span class="dv">3</span>) <span class="cf">else</span> <span class="dv">0</span>, axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [76]:</pre></div><div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df, columns<span class="op">=</span>[<span class="st">'InternetService'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [77]:</pre></div><div class="cell" data-execution_count="77">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[[<span class="st">'Contract'</span>,<span class="st">'tenure'</span>,<span class="st">'InternetService_Fiber optic'</span>,<span class="st">'MonthlyCharges'</span>,<span class="st">'InternetService_No'</span>,<span class="st">'Churn'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="splits-data-and-define-custom-function" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="splits-data-and-define-custom-function">Splits data and define custom function</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [78]:</pre></div><div class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> RandomizedSearchCV</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn <span class="im">import</span> metrics</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> imblearn.over_sampling <span class="im">import</span> SMOTE</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [79]:</pre></div><div class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(df.drop(columns<span class="op">=</span><span class="st">'Churn'</span>), df.Churn.to_numpy(), test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> X_train.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> X_test.reset_index(drop<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [80]:</pre></div><div class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_2(clf, X, y_true, thres <span class="op">=</span> np.arange(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="fl">0.1</span>)):</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>    result_dict <span class="op">=</span> {}</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> threshold <span class="kw">in</span> np.atleast_1d(thres):</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>        y_pred <span class="op">=</span> (clf.predict_proba(X)[:,<span class="dv">1</span>] <span class="op">&gt;</span> threshold).astype(<span class="bu">int</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>        X_segment <span class="op">=</span> (X[<span class="st">'MonthlyCharges'</span>] <span class="op">&gt;</span> <span class="dv">95</span>).to_numpy().astype(<span class="bu">int</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>        y_stack <span class="op">=</span> np.column_stack((X_segment, y_pred, y_true))</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>        y_stack_reg, y_stack_vip <span class="op">=</span> y_stack[y_stack[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">0</span>], y_stack[y_stack[:,<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>        cm_reg <span class="op">=</span> confusion_matrix(y_stack_reg[:,<span class="dv">2</span>], y_stack_reg[:,<span class="dv">1</span>])</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>        cm_vip <span class="op">=</span> confusion_matrix(y_stack_vip[:,<span class="dv">2</span>], y_stack_vip[:,<span class="dv">1</span>])</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>        fn_reg, fn_vip <span class="op">=</span> cm_reg[<span class="dv">1</span>][<span class="dv">0</span>], cm_vip[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>        fp <span class="op">=</span> cm_reg[<span class="dv">0</span>][<span class="dv">1</span>] <span class="op">+</span> cm_vip[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>        loss_score <span class="op">=</span> (fp <span class="op">*</span> <span class="dv">1</span>) <span class="op">+</span> (fn_reg <span class="op">*</span> <span class="dv">3</span>) <span class="op">+</span> (fn_vip <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>        result_dict[threshold] <span class="op">=</span> np.array([loss_score, metrics.precision_score(y_true, y_pred, zero_division <span class="op">=</span> <span class="dv">0</span>), </span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>                                           metrics.recall_score(y_true, y_pred), metrics.f1_score(y_true, y_pred)])</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>    result_np <span class="op">=</span> np.array([np.insert(value, <span class="dv">0</span>, key) <span class="cf">for</span> key, value <span class="kw">in</span> result_dict.items()])</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>    best_np <span class="op">=</span> result_np[result_np[:,<span class="dv">1</span>] <span class="op">==</span> np.<span class="bu">min</span>(result_np[:,<span class="dv">1</span>])][<span class="dv">0</span>]</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_np</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_threshold(clf, X, y_true):</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">0</span>]</span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_ls(clf, X, y_true):</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">1</span>]</span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_precision(clf, X, y_true):</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">2</span>]</span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_recall(clf, X, y_true):</span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">3</span>]</span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_scorer_f1(clf, X, y_true):</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> my_scorer_2(clf, X, y_true)[<span class="dv">4</span>]</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>        </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [81]:</pre></div><div class="cell" data-execution_count="81">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>grid_scoring <span class="op">=</span> {</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'threshold'</span>: my_scorer_threshold,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'loss_score'</span>: my_scorer_ls,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'precision'</span>: my_scorer_precision,</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'recall'</span>: my_scorer_recall,</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'f1'</span>: my_scorer_f1</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [82]:</pre></div><div class="cell" data-execution_count="82">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>X_segment <span class="op">=</span> (X_train[<span class="st">'MonthlyCharges'</span>] <span class="op">&gt;</span> <span class="dv">95</span>).to_numpy().astype(<span class="bu">int</span>)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>arr_weight <span class="op">=</span> np.column_stack((X_segment, y_train))</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>weight <span class="op">=</span> np.apply_along_axis(<span class="kw">lambda</span> x: <span class="dv">1</span> <span class="cf">if</span> x[<span class="dv">1</span>] <span class="op">==</span> <span class="dv">0</span> <span class="cf">else</span> <span class="dv">5</span> <span class="cf">if</span> x[<span class="dv">0</span>] <span class="op">==</span> <span class="dv">1</span> <span class="cf">else</span> <span class="dv">3</span> , axis<span class="op">=</span><span class="dv">1</span>, arr<span class="op">=</span>arr_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
<section id="model-building-1-hyperparameter-tuning-threshold-tuning" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="model-building-1-hyperparameter-tuning-threshold-tuning">Model building 1 / Hyperparameter tuning + threshold tuning</h3>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [83]:</pre></div><div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf <span class="op">=</span> {</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> RandomForestClassifier(),</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf,</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-28"><a href="#cb94-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb94-29"><a href="#cb94-29" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train, y_train)</span>
<span id="cb94-30"><a href="#cb94-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-31"><a href="#cb94-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb94-32"><a href="#cb94-32" aria-hidden="true" tabindex="-1"></a>mb1_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
<div class="cell-container column-page-left"><div class="cell-decorator"><pre>In [84]:</pre></div><div class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>NameError: name 'b' is not defined</code></pre>
</div>
</div></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg <span class="op">=</span> {</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> XGBClassifier(),</span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg,</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train)</span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train, y_train)</span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>mb1_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg <span class="op">=</span> {</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> LogisticRegression(),</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg,</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train)</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train, y_train)</span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>mb1_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>result_mb1 <span class="op">=</span> pd.DataFrame([mb1_rf,mb1_xg,mb1_lg])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>result_mb1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-building-2-hyperparameter-tuning-threshold-tuning-smote" class="level3">
<h3 class="anchored" data-anchor-id="model-building-2-hyperparameter-tuning-threshold-tuning-smote">Model building 2 / Hyperparameter tuning + threshold tuning + SMOTE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf_smote <span class="op">=</span> {</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>pipelinerf <span class="op">=</span> Pipeline([</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, RandomForestClassifier())])</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinerf,</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf_smote,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train)</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb100-35"><a href="#cb100-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb100-36"><a href="#cb100-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-37"><a href="#cb100-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb100-38"><a href="#cb100-38" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>params)</span>
<span id="cb100-39"><a href="#cb100-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-40"><a href="#cb100-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb100-41"><a href="#cb100-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb100-42"><a href="#cb100-42" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train1, y_train1)</span>
<span id="cb100-43"><a href="#cb100-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-44"><a href="#cb100-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb100-45"><a href="#cb100-45" aria-hidden="true" tabindex="-1"></a>mb2_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg_smote <span class="op">=</span> {</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>pipelinexg <span class="op">=</span> Pipeline([</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, XGBClassifier())])</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinexg,</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg_smote,</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train)</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>params)</span>
<span id="cb101-39"><a href="#cb101-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-40"><a href="#cb101-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb101-41"><a href="#cb101-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb101-42"><a href="#cb101-42" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train1, y_train1)</span>
<span id="cb101-43"><a href="#cb101-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-44"><a href="#cb101-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb101-45"><a href="#cb101-45" aria-hidden="true" tabindex="-1"></a>mb2_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg_smote <span class="op">=</span> {</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'class__max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="co">#create imbalanced pipeline to SMOTE </span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>pipelinelg <span class="op">=</span> Pipeline([</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'sampling'</span>, SMOTE()),</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>        (<span class="st">'class'</span>, LogisticRegression())])</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> pipelinelg,</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg_smote,</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train)</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>]</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>params_update <span class="op">=</span> {}</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key, value <span class="kw">in</span> params.items():</span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>    new_key <span class="op">=</span> key.replace(<span class="st">'class__'</span>, <span class="st">''</span>)</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a>    params_update[new_key] <span class="op">=</span> value</span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> params_update</span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb102-37"><a href="#cb102-37" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb102-38"><a href="#cb102-38" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>params)</span>
<span id="cb102-39"><a href="#cb102-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-40"><a href="#cb102-40" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with SMOTE train data</span></span>
<span id="cb102-41"><a href="#cb102-41" aria-hidden="true" tabindex="-1"></a>X_train1, y_train1 <span class="op">=</span> SMOTE().fit_resample(X_train, y_train)</span>
<span id="cb102-42"><a href="#cb102-42" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train1, y_train1)</span>
<span id="cb102-43"><a href="#cb102-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-44"><a href="#cb102-44" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb102-45"><a href="#cb102-45" aria-hidden="true" tabindex="-1"></a>mb2_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>result_mb2 <span class="op">=</span> pd.DataFrame([mb2_rf,mb2_xg,mb2_lg])</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>result_mb2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight" class="level3">
<h3 class="anchored" data-anchor-id="model-building-3-hyperparameter-tuning-threshold-tuning-custom-weight">Model building 3 / Hyperparameter tuning + threshold tuning + custom weight</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">#RANDOM FOREST MODELLING</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>param_grid_rf <span class="op">=</span> {</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">250</span> , <span class="dv">400</span>],</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>],</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_split'</span>: [<span class="dv">25</span>, <span class="dv">50</span>, <span class="dv">70</span>, <span class="dv">120</span>],</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'min_samples_leaf'</span>: [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">120</span>],</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'bootstrap'</span> : [<span class="va">True</span>, <span class="va">False</span>]</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> RandomForestClassifier(),</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_rf,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>rf.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(rf.cv_results_)</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb104-24"><a href="#cb104-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-25"><a href="#cb104-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb104-26"><a href="#cb104-26" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> RandomForestClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb104-27"><a href="#cb104-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-28"><a href="#cb104-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb104-29"><a href="#cb104-29" aria-hidden="true" tabindex="-1"></a>rf <span class="op">=</span> rf.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb104-30"><a href="#cb104-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-31"><a href="#cb104-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb104-32"><a href="#cb104-32" aria-hidden="true" tabindex="-1"></a>mb3_rf <span class="op">=</span> my_scorer_2(rf, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#XGBOOST MODELLING</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>param_grid_xg <span class="op">=</span> {</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'learning_rate'</span>: [<span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>],</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'n_estimators'</span>: [<span class="dv">100</span>, <span class="dv">500</span>],</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_depth'</span>: [<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'subsample'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>],</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'colsample_bytree'</span>: [<span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1.0</span>]</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> XGBClassifier(),</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_xg,</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>xg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(xg.cv_results_)</span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> XGBClassifier(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>xg <span class="op">=</span> xg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>mb3_xg <span class="op">=</span> my_scorer_2(xg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOGISTIC REGRESSION MODELLING</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co">#define parameter for tuning</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>param_grid_lg <span class="op">=</span> {</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'penalty'</span>: [<span class="st">'l1'</span>, <span class="st">'l2'</span>], </span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'C'</span>: [<span class="fl">0.1</span>, <span class="fl">1.0</span>, <span class="fl">10.0</span>],  </span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'solver'</span>: [<span class="st">'liblinear'</span>],  </span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'max_iter'</span>: [<span class="dv">50</span>,<span class="dv">100</span>,<span class="dv">200</span>] </span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a><span class="co">#run grid search cv</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> GridSearchCV(estimator <span class="op">=</span> LogisticRegression(),</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>                  param_grid <span class="op">=</span> param_grid_lg,</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>                  cv<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>                  scoring <span class="op">=</span> grid_scoring, refit<span class="op">=</span><span class="va">False</span>, n_jobs <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a><span class="co">#fit grid search cv with train data</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>lg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a><span class="co">#selecting the best parameter and metrics</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> pd.DataFrame(lg.cv_results_)</span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>grid_result <span class="op">=</span> grid_result[grid_result[<span class="st">'mean_test_loss_score'</span>] <span class="op">==</span> grid_result[<span class="st">'mean_test_loss_score'</span>].<span class="bu">min</span>()][[<span class="st">'params'</span>,<span class="st">'mean_test_threshold'</span>,<span class="st">'mean_test_loss_score'</span>,<span class="st">'mean_test_precision'</span>,<span class="st">'mean_test_recall'</span>,<span class="st">'mean_test_f1'</span>]]</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with the best hyperparameter</span></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> LogisticRegression(<span class="op">**</span>grid_result.iloc[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a><span class="co">#train model with train data</span></span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>lg <span class="op">=</span> lg.fit(X_train, y_train, sample_weight <span class="op">=</span> weight)</span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a><span class="co">#evaluate the model</span></span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>mb3_lg <span class="op">=</span> my_scorer_2(lg, X_test, y_test, grid_result.iloc[<span class="dv">0</span>,<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>result_mb3 <span class="op">=</span> pd.DataFrame([mb3_rf,mb3_xg,mb3_lg])</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>result_mb3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#—————stop——————————————-</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> PartialDependenceDisplay</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> partial_dependence</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>pdp <span class="op">=</span> partial_dependence(rf, X_test, <span class="st">'MonthlyCharges'</span>, kind<span class="op">=</span><span class="st">'both'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> np.array(pdp[<span class="st">'values'</span>])</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>values <span class="op">=</span> values[<span class="dv">0</span>]</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>individual <span class="op">=</span> pdp[<span class="st">'individual'</span>].reshape(<span class="op">-</span><span class="dv">1</span>, pdp[<span class="st">'individual'</span>].shape[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>individual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>individual.mean(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(x<span class="op">=</span>values, y<span class="op">=</span>individual.mean(axis<span class="op">=</span><span class="dv">0</span>), </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>             markers<span class="op">=</span><span class="va">True</span>, legend<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>sns.lineplot(data<span class="op">=</span>pd.DataFrame(individual, columns<span class="op">=</span>values)<span class="op">\</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                    .sample(<span class="dv">50</span>).reset_index().melt(<span class="st">'index'</span>), </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>             x<span class="op">=</span><span class="st">'variable'</span>, y<span class="op">=</span><span class="st">'value'</span>, style<span class="op">=</span><span class="st">'index'</span>, dashes<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a>             legend<span class="op">=</span><span class="va">False</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, size<span class="op">=</span><span class="dv">1</span>, color<span class="op">=</span><span class="st">'#63C1A4'</span>)</span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Partial dependence"</span>)</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'MonthlyCharges'</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame(individual, columns<span class="op">=</span>values).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-scrolled="true">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>df1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>individual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>individual1 <span class="op">=</span> np.pad(np.diff(individual, axis <span class="op">=</span> <span class="dv">1</span>), ((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">1</span>)), mode<span class="op">=</span><span class="st">'constant'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>arr <span class="op">=</span> [[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>],[<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">9</span>],[<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>np.diff(arr, append<span class="op">=</span>arr[<span class="op">-</span><span class="dv">1</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>padded_arr <span class="op">=</span> np.pad(arr, ((<span class="dv">0</span>, <span class="dv">0</span>), (<span class="dv">0</span>, <span class="dv">1</span>)), mode<span class="op">=</span><span class="st">'constant'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>padded_arr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>
     </main> <!-- /main -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content --> 
  

</body></html>